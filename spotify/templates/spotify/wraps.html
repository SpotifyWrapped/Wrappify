{% load i18n %}

{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% trans "Spotify Wrapped" %}</title>
    <!-- Linking the CSS file -->
    <link rel="stylesheet" href="{% static 'spotify/wraps.css' %}">
    <!-- Linking the JavaScript for slideshow functionality -->
    <script src="{% static 'spotify/slideshow.js' %}" defer></script>
</head>
<body>

    <!-- Full-screen slideshow container -->
    <div class="container-full">

        <!-- Thin Progress bars for each slide -->
        <div class="progress-bars">
            <div class="progress-bar" onclick="goToSlide(0)"></div>
            <div class="progress-bar" onclick="goToSlide(1)"></div>
            <div class="progress-bar" onclick="goToSlide(2)"></div>
            <div class="progress-bar" onclick="goToSlide(3)"></div>
            <div class="progress-bar" onclick="goToSlide(4)"></div>
            <div class="progress-bar" onclick="goToSlide(5)"></div>
            <div class="progress-bar" onclick="goToSlide(6)"></div>
            <div class="progress-bar" onclick="goToSlide(7)"></div>
            <div class="progress-bar" onclick="goToSlide(8)"></div>
            <div class="progress-bar" onclick="goToSlide(9)"></div>
        </div>

        <!-- Slideshow Container -->

        <!-- Slide 1: Intro Slide -->
<div class="slides active" id="slide1">
    <section id="intro">
        <h2>{% trans "Welcome to Your Spotify Wrapped" %}</h2>
        <p>{% trans "Let’s take a look at your music habits over" %} {{ time_range_label }}!</p>
    </section>
</div>

<!-- Slide 2: Total Playback Time with Peak Day -->
<div class="slides" id="slide2">
    <section id="total-playback-time">
        <h2>{% trans "My Minutes Listened" %}</h2>
        <p>{% trans "You have listened to approximately" %} {{ total_playback_minutes }} {% trans "minutes in" %} {{ time_range_label }}.</p>
        {% if peak_day %}
            <p>{% trans "Your peak listening day was" %} <strong>{{ peak_day }}</strong> {% trans "with" %} <strong>{{ peak_minutes }}</strong> {% trans "minutes listened." %}</p>
        {% endif %}
    </section>
</div>


        <!-- Slide 3: Top Genres -->
        <div class="slides" id="slide3">
            <section id="top-genres">
                <h2>{% trans "My Top Genres" %}</h2>
                <ul>
                    {% for genre, count in top_genres %}
                        <li>{{ genre }} ({{ count }} times)</li>
                    {% empty %}
                        <li>{% trans "No top genres available." %}</li>
                    {% endfor %}
                </ul>
            </section>
        </div>

        <!-- Slide 4: Top Tracks -->
        <div class="slides" id="slide4">
            <section id="top-tracks">
                <h2>{% trans "My Top Songs" %}</h2>
                <ul>
                    {% for track in tracks %}
                        <li>
                            <strong>{{ forloop.counter }}.</strong> <!-- Adding number before track name -->
                            <img src="{{ track.album.images.0.url }}" alt="{{ track.name }}" width="100">
                            <p>{{ track.name }} by {{ track.artists.0.name }}</p>
                            {% if track.preview_url %}
                                <audio controls>
                                    <source src="{{ track.preview_url }}" type="audio/mpeg">
                                    {% trans "Your browser does not support the audio element." %}
                                </audio>
                            {% endif %}
                        </li>
                    {% empty %}
                        <li>{% trans "No top tracks available." %}</li>
                    {% endfor %}
                </ul>
            </section>
        </div>

        <!-- Slide 5: Mood Analysis (Vibe) -->
        <div class="slides" id="slide5">
            <section id="audio-mood">
                <h2>My Vibe</h2>
                <p><strong>{% trans "Danceability:" %}</strong> {{ avg_danceability }} ({% trans "How much your tracks make you want to dance" %})</p>
                <p><strong>{% trans "Energy:" %}</strong> {{ avg_energy }} ({% trans "How energetic and intense your music is" %})</p>
                <p><strong>{% trans "Happiness" %} (Valence):</strong> {{ avg_valence }} ({% trans "How positive your tracks feel" %})</p>
            </section>
        </div>

        <!-- Slide 6: Transition Slide (Who's your #1) -->
        <div class="slides" id="slide6">
            <section id="extra-slide">
                <h2>{% trans "HMM... Who's that special someone?" %}</h2>
                <p>{% trans "Someone you just can't stop listening to..." %}</p>
            </section>
        </div>

        <!-- Slide 7: #1 Artist Deep Dive -->
        {% if top_artist %}
        <div class="slides" id="slide7">
            <section id="top-artist-deep-dive">
                <h2>{% trans "Your #1 Artist:" %}" {{ top_artist.name }}</h2>
                <img src="{{ top_artist.images.0.url }}" alt="{{ top_artist.name }}" width="100">
                <p><strong>{% trans "Genres:" %}</strong> {{ top_artist.genres|join:", " }}</p>
                <p><strong>{% trans "Popularity:" %}</strong> {{ top_artist.popularity }} / 100</p>
                <p><strong>{% trans "Followers:" %}</strong> {{ top_artist.followers.total|floatformat }}</p>
            </section>
        </div>
        {% endif %}

        <!-- Slide 8: Top Artists -->
        <div class="slides" id="slide8">
            <section id="top-artists">
                <h2>{% trans "My Top Artists" %}</h2>
                <ul>
                    {% for artist in artists %}
                        <li>
                            <strong>{{ forloop.counter }}.</strong> <!-- Adding number before artist name -->
                            <img src="{{ artist.images.0.url }}" alt="{{ artist.name }}" width="100">
                            <p>{{ artist.name }}</p>
                        </li>
                    {% empty %}
                        <li>{% trans "No top artists available." %}</li>
                    {% endfor %}
                </ul>
            </section>
        </div>

        <!-- Slide 9: Recommended Songs -->
        <div class="slides" id="slide9">
            <section id="recommendations">
                <h2>{% trans "Recommended Songs" %}</h2>
                <ul>
                    {% for rec in recommendations %}
                        <li>
                            <img src="{{ rec.album.images.0.url }}" alt="{{ rec.name }}" width="100">
                            <p>{{ rec.name }} by {{ rec.artists.0.name }}</p>
                            {% if rec.preview_url %}
                                <audio controls>
                                    <source src="{{ rec.preview_url }}" type="audio/mpeg">
                                    {% trans "Your browser does not support the audio element." %}"
                                </audio>
                            {% else %}
                                <p>{% trans "No preview available" %}</p>
                            {% endif %}
                        </li>
                    {% empty %}
                        <li>{% trans "No recommendations available." %}</li>
                    {% endfor %}
                </ul>
            </section>
        </div>

        <!-- Slide 10: Save or Delete Wrap -->
        <div class="slides" id="slide10">
            <section id="save-delete">
                <h2>{% trans "Save or Delete Your Wrap" %}</h2>
                <p>{% trans "Would you like to save this wrap for later, or delete it?" %}</p>
                <div class="options">
                    <button>{% trans "Save" %}</button>
                    <button>{% trans "Delete" %}</button>
                </div>
                <!-- Go Back to Home Button -->
                <div class="back-home">
                    <a href="{% url 'profile' %}" class="back-home-button">{% trans "Go Back to Home" %}</a>
                </div>
            </section>
        </div>

    </div>

    <script src="{% static 'js/main.js' %}"></script>
</body>
</html>

{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Wrapped</title>
    <!-- Linking the CSS file -->
    <link rel="stylesheet" href="{% static 'spotify/wraps.css' %}">
    <!-- Linking the JavaScript for slideshow functionality -->
    <script src="{% static 'spotify/slideshow.js' %}" defer></script>
</head>
<body>

    <!-- Full-screen slideshow container -->
    <div class="container-full">

        <!-- Thin Progress bars for each slide -->
        <div class="progress-bars">
            <div class="progress-bar" onclick="goToSlide(0)"></div>
            <div class="progress-bar" onclick="goToSlide(1)"></div>
            <div class="progress-bar" onclick="goToSlide(2)"></div>
            <div class="progress-bar" onclick="goToSlide(3)"></div>
            <div class="progress-bar" onclick="goToSlide(4)"></div>
            <div class="progress-bar" onclick="goToSlide(5)"></div>
            <div class="progress-bar" onclick="goToSlide(6)"></div>
            <div class="progress-bar" onclick="goToSlide(7)"></div>
            <div class="progress-bar" onclick="goToSlide(8)"></div>
        </div>

        <!-- Slide 1: Intro Slide -->
        <div class="slides active" id="slide1">
            <section id="intro">
                <h2>Welcome to Your Spotify Wrapped</h2>
                <p>Let’s take a look at your music habits over {{ time_range_label }}!</p>
            </section>
        </div>

        <!-- Slide 2: Top Genres -->
        <div class="slides" id="slide2">
            <section id="top-genres">
                <h2>My Top Genres</h2>
                <ul>
                    {% for genre, count in top_genres %}
                        <li>{{ genre }} ({{ count }} times)</li>
                    {% empty %}
                        <li>No top genres available.</li>
                    {% endfor %}
                </ul>
            </section>
        </div>

        <!-- Slide 3: Top Tracks -->
        <div class="slides" id="slide3">
            <section id="top-tracks">
                <h2>My Top Songs</h2>
                <ul>
                    {% for track in tracks %}
                        <li>
                            <strong>{{ forloop.counter }}.</strong>
                            <img src="{{ track.album.images.0.url }}" alt="{{ track.name }}" width="100">
                            <p>{{ track.name }} by {{ track.artists.0.name }}</p>
                            {% if track.preview_url %}
                                <audio controls>
                                    <source src="{{ track.preview_url }}" type="audio/mpeg">
                                    Your browser does not support the audio element.
                                </audio>
                            {% endif %}
                        </li>
                    {% empty %}
                        <li>No top tracks available.</li>
                    {% endfor %}
                </ul>
            </section>
        </div>

        <!-- Slide 4: Mood Analysis (Vibe) -->
        <div class="slides" id="slide4">
            <section id="audio-mood">
                <h2>My Vibe</h2>
                <p><strong>Danceability:</strong> {{ avg_danceability|floatformat:2 }} (How much your tracks make you want to dance)</p>
                <p><strong>Energy:</strong> {{ avg_energy|floatformat:2 }} (How energetic and intense your music is)</p>
                <p><strong>Happiness (Valence):</strong> {{ avg_valence|floatformat:2}} (How positive your tracks feel)</p>
            </section>
        </div>


        <!-- Slide 5: Transition Slide (Who's your #1) -->
        <div class="slides" id="slide5">
            <section id="extra-slide">
                <h2>HMM... Who's that special someone?</h2>
                <p>Someone you just can't stop listening to...</p>
            </section>
        </div>

        <!-- Slide 6: #1 Artist Deep Dive -->
        <div class="slides" id="slide6">
            <section id="top-artist-deep-dive">
                {% if top_artist %}
                    <h2>Your #1 Artist: {{ top_artist.name }}</h2>
                    <img src="{{ top_artist.images.0.url }}" alt="{{ top_artist.name }}" width="100">
                    <p><strong>Genres:</strong> {{ top_artist.genres|join:", " }}</p>
                    <p><strong>Popularity:</strong> {{ top_artist.popularity }} / 100</p>
                    <p><strong>Followers:</strong> {{ top_artist.followers.total|floatformat }}</p>
                {% else %}
                    <h2>No top artist available</h2>
                    <p>It seems like you haven't listened to enough music recently to have a top artist.</p>
                {% endif %}
            </section>
        </div>

        <!-- Slide 7: Top Artists -->
        <div class="slides" id="slide7">
            <section id="top-artists">
                <h2>My Top Artists</h2>
                <ul>
                    {% for artist in artists %}
                        <li>
                            <strong>{{ forloop.counter }}.</strong>
                            <img src="{{ artist.images.0.url }}" alt="{{ artist.name }}" width="100">
                            <p>{{ artist.name }}</p>
                        </li>
                    {% empty %}
                        <li>No top artists available.</li>
                    {% endfor %}
                </ul>
            </section>
        </div>

        <!-- Slide 8: Recommended Songs -->
        <div class="slides" id="slide8">
            <section id="recommendations">
                <h2>Recommended Songs</h2>
                <ul>
                    {% for rec in recommendations %}
                        <li>
                            <img src="{{ rec.album.images.0.url }}" alt="{{ rec.name }}" width="100">
                            <p>{{ rec.name }} by {{ rec.artists.0.name }}</p>
                            {% if rec.preview_url %}
                                <audio controls>
                                    <source src="{{ rec.preview_url }}" type="audio/mpeg">
                                    Your browser does not support the audio element.
                                </audio>
                            {% else %}
                                <p>No preview available</p>
                            {% endif %}
                        </li>
                    {% empty %}
                        <li>No recommendations available.</li>
                    {% endfor %}
                </ul>
            </section>
        </div>

        <!-- Slide 9: Save Wrap -->
        <div class="slides" id="slide9">
            <section id="save-delete">
                <h2>Save Wrap</h2>
                <div class="options">
                    <button onclick="saveWrap()">Save</button>
                </div>
                <div class="back-home">
                    <a href="{% url 'profile' %}" class="back-home-button">Back to Profile</a>
                </div>
            </section>
        </div>
    </div>

    <!-- JSON Script to pass data to JavaScript -->
    <script type="application/json" id="wrap-data">
        {{ wrap_data_json|safe }}
    </script>

    <script>
        function getCSRFToken() {
            const name = 'csrftoken';
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                cookie = cookie.trim();
                if (cookie.startsWith(name + '=')) {
                    return cookie.substring(name.length + 1);
                }
            }
            return '';
        }
    
        function saveWrap() {
            // Parse the JSON data from the script tag
            const wrapData = JSON.parse(document.getElementById('wrap-data').textContent);
    
            fetch("{% url 'save_wrap' %}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken()
                },
                body: JSON.stringify(wrapData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (data.message) {
                    alert(data.message);
                } else if (data.error) {
                    alert("Error: " + data.error);
                }
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>