{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account</title>
    <link id="theme-style" rel="stylesheet" href="{% static 'spotify/account-light.css' %}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
</head>
<body data-page="account">

    <div class="top-section">
        <img src="{% static 'spotify/images/wwlogo.png' %}" alt="Logo" class="logo">
        {% if profile_image_url %}
            <img src="{{ profile_image_url }}" alt="Profile Picture" class="profile-image">
        {% else %}
            <img src="{% static 'images/pfp.png' %}" alt="Default Profile Picture" class="profile-image">
        {% endif %}
        <div class="name-and-link">
            <h1 class="username">{{ request.user.first_name }}</h1>
            {% if user_data.external_urls and user_data.external_urls.spotify %}
                <p><a href="{{ user_data.external_urls.spotify }}" class="spotify-link">Open in Spotify</a></p>
            {% endif %}
        </div>
    </div>

    <div class="content">
        <div class="spotify-account">
            <h1 class="account-title">Spotify Account</h1>
            <p class="account-description">The Spotify account that you're signed in with.</p>
            <div class="account-details">
                <p><span class="field-title">Username:</span> <span class="field-value">{{ request.user.first_name }}</span></p>
                <p><span class="field-title">Email:</span> <span class="field-value">{{ request.user.email }}</span></p>
            </div>
        </div>

        <div class="delete-account">
            <h1 class="delete-title">Delete Wrappify Account</h1>
            <p class="delete-description">This will permanently delete your account.</p>
            <form action="{% url 'delete_account' %}" method="POST" id="delete-account-form" class="delete-account-form">
                {% csrf_token %}
                <button type="button" class="delete-button" onclick="confirmDelete()">Delete Account</button>
            </form>
        </div>

        <!-- Language Selection Box -->
        <div class="settings-box">
            <h2 class="settings-title">Change Language</h2>
            <select id="language" name="language">
                <option value="en">English</option>
                <option value="es">Spanish</option>
                <option value="fr">French</option>
                <option value="de">German</option>
                <option value="zh">Chinese</option>
            </select>
        </div>

        <!-- Theme Selection Box -->
        <div class="settings-box">
            <h2 class="settings-title">More Themes</h2>
        </div>


    </div>

    <!-- Footer Section -->
    <footer>
        <a href="{% url 'profile' %}" class="home-button">Back Home</a>
    </footer>

    <script>
        // Paths to your light and dark CSS files by page
        const themePaths = {
            profile: {
                light: "{% static 'spotify/profile-light.css' %}",
                dark: "{% static 'spotify/profile-dark.css' %}",
            },
            wraps: {
                light: "{% static 'spotify/wraps-light.css' %}",
                dark: "{% static 'spotify/wraps-dark.css' %}",
            },
            wraps_library: {
                light: "{% static 'spotify/library-light.css' %}",
                dark: "{% static 'spotify/library-dark.css' %}",
            },
            game: {
                light: "{% static 'spotify/game-light.css' %}",
                dark: "{% static 'spotify/game-dark.css' %}",
            },
            account: {
                light: "{% static 'spotify/account-light.css' %}",
                dark: "{% static 'spotify/account-dark.css' %}",
            },
        };
    
        // Get references to elements
        const themeStyle = document.getElementById('theme-style');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const darkModeText = document.getElementById('dark-mode-text');
        const darkModeIcon = document.getElementById('dark-mode-icon');
        const currentPage = document.body.dataset.page;
    
        // Function to apply the theme
        function applyTheme(theme) {
            if (currentPage && themePaths[currentPage]) {
                themeStyle.setAttribute('href', theme === 'dark' ? themePaths[currentPage].dark : themePaths[currentPage].light);
            }
            if (darkModeText) {
                darkModeText.textContent = theme === 'dark' ? 'Dark Mode' : 'Light Mode'; // Update text dynamically
            }
            if (darkModeIcon) {
                darkModeIcon.src = theme === 'dark' ? "{% static 'images/darkmode.png' %}" : "{% static 'images/lightmode.png' %}";
            }
            if (darkModeToggle) {
                darkModeToggle.checked = theme === 'dark';
            }
        }
    
        // Initialize theme from localStorage
        const savedTheme = localStorage.getItem('theme') || 'light';
        applyTheme(savedTheme);
    
        // Listen for toggle changes and update theme dynamically
        if (darkModeToggle) {
            darkModeToggle.addEventListener('change', () => {
                const newTheme = darkModeToggle.checked ? 'dark' : 'light';
                localStorage.setItem('theme', newTheme); // Save theme to localStorage
                applyTheme(newTheme); // Apply theme to current page
            });
        }
    
        // Listen for theme changes across tabs
        window.addEventListener('storage', (event) => {
            if (event.key === 'theme') {
                applyTheme(event.newValue); // Apply the new theme when detected
            }
        });
    </script>
    

</body>
</html>
